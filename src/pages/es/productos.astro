---
// src/pages/es/productos.astro
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import ProductCard from '../../components/ProductCard.astro';
import IndustrialPartCard from '../../components/IndustrialPartCard.astro';
import ProductTable from '../../components/ProductTable.astro';
import Footer from '../../components/Footer.astro';
import site from '../../data/site.json';

// Datos de ejemplo - reemplazar con datos de CMS o BD
const productos = [
  {
    id: 1,
    partNumber: 'AP-001',
    title: 'Aros de Pistón',
    category: 'Aros',
    description: 'Aros de compresión y guía para asegurar un sellado eficiente y prolongar la vida útil.',
    image: '/docs/producto 1.jpg',
    inStock: true,
    pdf: '', // Aros no suelen tener PDF único
    specs: { 'Material': 'Hierro Fundido/Bronce/PTFE', 'Tipo': 'Compresión/Guía' }
  },
  {
    id: 2,
    partNumber: 'VAL-002',
    title: 'Válvulas',
    category: 'Válvulas',
    description: 'Válvulas de admisión, escape y concéntricas de alta eficiencia.',
    image: '/docs/producto 2.jpg',
    inStock: true,
    pdf: '',
    specs: { 'Material': 'Acero / Inoxidable', 'Presión': 'Alta/Baja' }
  },
  {
      id: 3,
      partNumber: 'PD-003',
      title: 'Pistón Descargador',
      category: 'Pistones',
      description: 'Componentes para sistemas de regulación y control de carga.',
        image: '/docs/producto 3.jpeg',
      inStock: true,
      pdf: '',
      specs: { 'Aplicación': 'Control de carga' }
  },
  {
      id: 4,
      partNumber: 'JUN-004',
      title: 'Juntas',
      category: 'Juntas',
      description: 'Juntas para sellado estático en tapas, cilindros y cárter.',
        image: '/docs/producto 4.jpeg',
      inStock: true,
      pdf: '',
      specs: { 'Tipos': 'Tapas, Cilindros' }
  },
  {
      id: 5,
      partNumber: 'SV-005',
      title: 'Sellos de Vástago',
      category: 'Sellos',
      description: 'Empaquetaduras y sellos dinámicos para vástagos.',
        image: '/docs/producto 5.jpeg',
      inStock: true,
      pdf: '',
      specs: { 'Función': 'Sellado dinámico' }
  },
  {
      id: 6,
      partNumber: 'RI-006',
      title: 'Repuestos Internos',
      category: 'Repuestos',
      description: 'Cojinetes, pernos, bujes y otros componentes internos.',
        image: '/docs/producto 6.jpeg',
      inStock: true,
      pdf: '',
      specs: { 'Componentes': 'Varios' }
      },
      {
        id: 7,
        partNumber: 'VAL-007',
        title: 'Válvulas Concéntricas',
        category: 'Válvulas',
        description: 'Conjuntos concéntricos de admisión y descarga para alto rendimiento.',
        image: '/docs/image copy.png',
        inStock: true,
        pdf: '',
        specs: { 'Tipo': 'Concéntricas', 'Aplicación': 'Admisión/Descarga' }
      },
      {
        id: 8,
        partNumber: 'EMP-008',
        title: 'Empaquetaduras de Vástago',
        category: 'Empaquetaduras',
        description: 'Rascadores de aceite y empaquetaduras de presión (tangencial/radial).',
        image: '/docs/image copy 8.png',
        inStock: true,
        pdf: '',
        specs: { 'Materiales': 'Babbit, Bronce, PTFE/Grafito', 'Tipo': 'Tangencial/Radial' }
      },
      {
        id: 9,
        partNumber: 'ARO-009',
        title: 'Aros Guía',
        category: 'Aros',
        description: 'Aros guía para pistón en PTFE con carga, bronce o micarta.',
        image: '/docs/image copy 9.png',
        inStock: true,
        pdf: '',
        specs: { 'Material': 'PTFE/BRONCE/MICARTA', 'Función': 'Guía' }
      },
      {
        id: 10,
        partNumber: 'JUN-010',
        title: 'Juntas Especiales',
        category: 'Juntas',
        description: 'Juntas en grafito, cobre, aluminio y Klinger bajo plano o muestra.',
        image: '/docs/image copy 10.png',
        inStock: true,
        pdf: '',
        specs: { 'Materiales': 'Grafito/Cobre/Aluminio/Klinger' }
  }
];
---

<Layout title="Productos | Repuestos para Compresores a Pistón" description="Válvulas, empaquetaduras, aros, juntas y mecanizado de piezas especiales.">
  <Header />

  <main class="min-h-screen bg-white">
    {/* Header */}
    <div class="bg-gradient-to-b from-gray-50 to-white py-12">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
          Catálogo de Productos
        </h1>
        <p class="text-lg text-gray-600">
          Explore nuestra amplia selección de equipamiento industrial profesional
        </p>
      </div>
    </div>

    {/* Products Grid */}
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
      <div class="mb-6">
        <div class="flex flex-col md:flex-row md:items-center md:gap-4">
          <input id="page-search-input" type="search" placeholder="Filtrar por código, nombre o categoría" class="w-full md:w-1/2 border border-gray-300 rounded-lg py-2 px-3 text-sm" />
          <div class="mt-3 md:mt-0 flex gap-2">
            <button id="view-grid" type="button" class="px-3 py-2 bg-white border border-gray-300 rounded text-sm">Vista Cuadrícula</button>
            <button id="view-table" type="button" class="px-3 py-2 bg-white border border-gray-300 rounded text-sm">Vista Tabla</button>
          </div>
        </div>
        <p id="search-results" class="text-sm text-gray-600 mt-2"></p>
      </div>

      <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {productos.map((producto) => (
          <IndustrialPartCard
            partNumber={producto.partNumber}
            name={producto.title}
            specs={producto.specs}
            image={producto.image}
            inStock={producto.inStock}
            pdf={producto.pdf}
          />
        ))}
      </div>

      <div id="products-table" class="hidden mt-8">
        <ProductTable products={productos} />
      </div>
    </div>

    {/* CTA Final */}
    <section class="bg-bergner-red text-white py-16 mt-12">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-3xl md:text-4xl font-bold mb-4">¿No encontró lo que buscaba?</h2>
        <p class="text-lg mb-8 opacity-90">
          Contáctenos para consultar por otros productos o realizar un pedido a medida.
        </p>
        <a 
          href={`https://wa.me/${site.whatsappNumber}?text=${encodeURIComponent('Hola, tengo una consulta sobre productos Bergner...')}`}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-block bg-white text-bergner-red hover:bg-gray-100 px-8 py-4 rounded-lg font-bold transition-colors"
        >
          Contactar por WhatsApp
        </a>
      </div>
    </section>
  </main>

  <Footer />
</Layout>

<script>
  (function(){
    const params = new URLSearchParams(location.search);
    const q = (params.get('q')||'').toLowerCase().trim();
    const grid = document.getElementById('products-grid');
    const items = grid?.querySelectorAll('[data-title]');
    const headerInput = document.getElementById('header-search-input');
    const pageInput = document.getElementById('page-search-input');
    const resultsEl = document.getElementById('search-results');

    if(headerInput && q) headerInput.value = params.get('q');
    if(pageInput && q) pageInput.value = params.get('q');

    function filter(term){
      const t = (term||'').toLowerCase().trim();
      let any=false;
      items?.forEach(el=>{
        const title = (el.dataset.title||'').toLowerCase();
        const cat = (el.dataset.category||'').toLowerCase();
        const desc = (el.dataset.description||'').toLowerCase();
        const show = !t || title.includes(t) || cat.includes(t) || desc.includes(t);
        el.style.display = show ? '' : 'none';
        if(show) any = true;
      });
      if(resultsEl){
        resultsEl.textContent = t ? (any ? `Resultados para "${t}"` : `No se encontraron resultados para "${t}"`) : '';
      }
    }

    // initial
    filter(q);

    // listen for input on page
    if(pageInput){
      pageInput.addEventListener('input', (e)=>{
        const val = e.target.value;
        history.replaceState(null, '', val ? `?q=${encodeURIComponent(val)}` : location.pathname);
        if(headerInput) headerInput.value = val;
        filter(val);
      });
    }

    // View toggle (grid / table)
    const btnGrid = document.getElementById('view-grid');
    const btnTable = document.getElementById('view-table');
    const gridEl = document.getElementById('products-grid');
    const tableEl = document.getElementById('products-table');

    function setView(view){
      if(view==='table'){
        gridEl.classList.add('hidden');
        tableEl.classList.remove('hidden');
        history.replaceState(null,'',`?view=table${pageInput?.value?`&q=${encodeURIComponent(pageInput.value)}`:''}`);
      } else {
        tableEl.classList.add('hidden');
        gridEl.classList.remove('hidden');
        history.replaceState(null,'',`${location.pathname}${pageInput?.value?`?q=${encodeURIComponent(pageInput.value)}`:''}`);
      }
    }

    btnGrid?.addEventListener('click', ()=> setView('grid'));
    btnTable?.addEventListener('click', ()=> setView('table'));

    // initialize view param
    const viewParam = new URLSearchParams(location.search).get('view');
    if(viewParam==='table') setView('table');
  })();
</script>
