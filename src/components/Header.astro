---
import site from '../data/site.json';
// src/components/Header.astro

// Obtenemos la URL actual para saber en qu칠 idioma estamos
const currentPath = Astro.url.pathname;
const isEnglish = currentPath.startsWith('/en');

// Definir el prefijo de idioma
const langPrefix = isEnglish ? '/en' : '';

// Calcular la URL del otro idioma
const getOtherLanguagePath = (path: string): string => {
  if (isEnglish) {
    // Pasar de /en/xxx a /xxx
    return path.replace(/^\/en/, '') || '/';
  } else {
    // Pasar de /xxx a /en/xxx
    return path === '/' ? '/en' : `/en${path}`;
  }
};

const otherLanguagePath = getOtherLanguagePath(currentPath);

// Textos din치micos por idioma
const texts = {
  inicio: isEnglish ? 'Home' : 'Inicio',
  servicios: isEnglish ? 'Services' : 'Servicios',
  productos: isEnglish ? 'Products' : 'Productos',
  nosotros: isEnglish ? 'About' : 'Nosotros',
  contacto: isEnglish ? 'Contact' : 'Contacto',
  buscar: isEnglish ? 'Search by code or model' : 'Buscar por c칩digo o modelo',
  cotizacion: isEnglish ? 'Quote' : 'Cotizaci칩n',
  hola: isEnglish ? 'Hello, I want to request a quote...' : 'Hola, quiero solicitar una cotizaci칩n...',
};
---

<header class="sticky top-0 z-40 bg-white border-b border-gray-100 shadow-sm">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-20 flex items-center justify-between">
    
    {/* Logo */}
    <div class="flex items-center gap-6 w-full">
      <div class="flex-shrink-0">
        <a href="/" class="text-2xl font-bold text-bergner-red">
          BERGNER
        </a>
        <p class="text-xs text-gray-500">Metal칰rgica Pipo</p>
      </div>

      <!-- Search (Desktop) -->
      <form action={`${langPrefix}/productos`} method="GET" class="hidden md:flex flex-1">
        <label for="q" class="sr-only">{texts.buscar}</label>
        <div class="relative w-full">
          <input id="header-search-input" name="q" type="search" placeholder={`${texts.buscar} (ej: 450-12)`} class="w-full border border-gray-300 rounded-lg py-3 px-4 pr-12 focus:outline-none focus:ring-2 focus:ring-bergner-red/50 bg-white text-sm" />
          <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 bg-bergner-red text-white px-3 py-2 rounded text-sm">{isEnglish ? 'Search' : 'Buscar'}</button>
        </div>
      </form>

      {/* Men칰 Desktop */}
      <nav class="hidden md:flex gap-8">
        <a href={`${langPrefix}/`} class="text-gray-700 hover:text-bergner-red transition-colors font-medium">
          {texts.inicio}
        </a>
        <a href={`${langPrefix}/servicios`} class="text-gray-700 hover:text-bergner-red transition-colors font-medium">
          {texts.servicios}
        </a>
        <a href={`${langPrefix}/productos`} class="text-gray-700 hover:text-bergner-red transition-colors font-medium">
          {texts.productos}
        </a>
        <a href={`${langPrefix}/nosotros`} class="text-gray-700 hover:text-bergner-red transition-colors font-medium">
          {texts.nosotros}
        </a>
        <a href={`${langPrefix}/contacto`} class="text-gray-700 hover:text-bergner-red transition-colors font-medium">
          {texts.contacto}
        </a>
      </nav>

    {/* CTA Button + Language + Mobile Menu */}
    <div class="flex items-center gap-3">
      {/* Language Switcher */}
      <a 
        href={otherLanguagePath} 
        class="flex items-center gap-1.5 px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium text-gray-700 hidden sm:flex"
        aria-label={isEnglish ? "Cambiar a Espa침ol" : "Switch to English"}
        title={isEnglish ? "Cambiar a Espa침ol" : "Switch to English"}
      >
        {isEnglish ? (
          <>
            <span>游쀯릖</span>
            <span>ES</span>
          </>
        ) : (
          <>
            <span>游쥟릖</span>
            <span>EN</span>
          </>
        )}
      </a>

      <a 
        href={`https://wa.me/${site.whatsappNumber}?text=${encodeURIComponent(texts.hola)}`}
        target="_blank"
        rel="noopener noreferrer"
        class="hidden sm:block bg-bergner-red hover:bg-red-700 text-white px-5 py-2 rounded-lg font-medium transition-colors text-sm"
      >
        {texts.cotizacion}
      </a>

      {/* Hamburger Menu (Mobile) */}
      <button 
        id="mobile-menu-toggle"
        class="md:hidden flex flex-col gap-1.5 cursor-pointer"
        aria-label="Men칰 m칩vil"
      >
        <span class="w-6 h-0.5 bg-gray-800 block transition-all"></span>
        <span class="w-6 h-0.5 bg-gray-800 block transition-all"></span>
        <span class="w-6 h-0.5 bg-gray-800 block transition-all"></span>
      </button>
    </div>
  </div>

  {/* Mobile Menu */}
  <div id="mobile-menu" class="hidden md:hidden border-t border-gray-100 bg-white">
    <nav class="flex flex-col py-4 px-4">
      <a href={`${langPrefix}/`} class="py-2 text-gray-700 hover:text-bergner-red transition-colors font-medium">
        {texts.inicio}
      </a>
      <a href={`${langPrefix}/servicios`} class="py-2 text-gray-700 hover:text-bergner-red transition-colors font-medium">
        {texts.servicios}
      </a>
      <a href={`${langPrefix}/productos`} class="py-2 text-gray-700 hover:text-bergner-red transition-colors font-medium">
        {texts.productos}
      </a>
      <a href={`${langPrefix}/nosotros`} class="py-2 text-gray-700 hover:text-bergner-red transition-colors font-medium">
        {texts.nosotros}
      </a>
      <a href={`${langPrefix}/contacto`} class="py-2 text-gray-700 hover:text-bergner-red transition-colors font-medium">
        {texts.contacto}
      </a>
      <a 
        href={`https://wa.me/${site.whatsappNumber}?text=${encodeURIComponent(texts.hola)}`}
        target="_blank"
        rel="noopener noreferrer"
        class="mt-4 bg-bergner-red hover:bg-red-700 text-white px-5 py-2 rounded-lg font-medium transition-colors text-center"
      >
        {texts.cotizacion}
      </a>
    </nav>
  </div>
</header>

<script>
  const toggleButton = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');

  toggleButton?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden');
  });
</script>
