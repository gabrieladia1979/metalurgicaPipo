---
import site from '../data/site.json';
// src/components/Header.astro

// Obtenemos la URL actual para saber en quÃ© idioma estamos
const currentPath = Astro.url.pathname;
const isEnglish = currentPath.startsWith('/en');

// Definir el prefijo de idioma
const langPrefix = isEnglish ? '/en' : '/es';

// Calcular la URL del otro idioma
const getOtherLanguagePath = (path: string): string => {
  if (isEnglish) {
    // Pasar de /en/xxx a /es/xxx
    return path.replace(/^\/en/, '/es');
  } else {
    // Pasar de /es/xxx a /en/xxx
    return path.replace(/^\/es/, '/en');
  }
};

const otherLanguagePath = getOtherLanguagePath(currentPath);

// Textos dinÃ¡micos por idioma
const texts = {
  inicio: isEnglish ? 'Home' : 'Inicio',
  quienesSomos: isEnglish ? 'About Us' : 'QuiÃ©nes Somos',
  productos: isEnglish ? 'Products' : 'Productos',
  servicios: isEnglish ? 'Service' : 'Servicio TÃ©cnico',
  contacto: isEnglish ? 'Contact' : 'Contacto',
  buscar: isEnglish ? 'Search by code or model' : 'Buscar por cÃ³digo o modelo',
  cotizacion: isEnglish ? 'Quote' : 'CotizaciÃ³n',
  hola: isEnglish ? 'Hello, I want to request a quote...' : 'Hola, quiero solicitar una cotizaciÃ³n...',
};
---

<header class="sticky top-0 z-40 bg-white border-b border-gray-100 shadow-sm">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-20 flex items-center justify-between">
    
    {/* Logo */}
    <div class="flex items-center gap-6 w-full">
      <div class="flex-shrink-0">
        <a href={`${langPrefix}/`} class="block" aria-label="Bergner Home">
          <img src="/docs/logo.jpeg" alt="BERGNER Argentina" class="h-16 w-auto object-contain" />
        </a>
      </div>

      <!-- Search (Desktop) -->
      <form action={`${langPrefix}/productos`} method="GET" class="hidden xl:flex flex-1 max-w-xs">
        <label for="q" class="sr-only">{texts.buscar}</label>
        <div class="relative w-full">
          <input id="header-search-input" name="q" type="search" placeholder={`${texts.buscar} (450...)`} class="w-full border border-gray-300 rounded-lg py-2 px-3 pr-12 focus:outline-none focus:ring-2 focus:ring-bergner-red/50 bg-white text-sm" />
          <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 bg-bergner-red text-white px-2 py-1 rounded text-xs">{isEnglish ? 'Go' : 'Ir'}</button>
        </div>
      </form>

      {/* MenÃº Desktop */}
      <nav class="hidden lg:flex gap-5 text-sm uppercase tracking-wide">
        <a href={`${langPrefix}/`} class="text-gray-700 hover:text-bergner-red transition-colors font-medium">
          {texts.inicio}
        </a>
        <a href={`${langPrefix}/metalurgica-bergner`} class="text-gray-700 hover:text-bergner-red transition-colors font-medium">
          {texts.quienesSomos}
        </a>
        <a href={`${langPrefix}/productos`} class="text-gray-700 hover:text-bergner-red transition-colors font-medium">
          {texts.productos}
        </a>
        <a href={`${langPrefix}/servicio-tecnico`} class="text-gray-700 hover:text-bergner-red transition-colors font-medium">
          {texts.servicios}
        </a>
        <a href={`${langPrefix}/contacto`} class="text-gray-700 hover:text-bergner-red transition-colors font-medium">
          {texts.contacto}
        </a>
      </nav>

    {/* CTA Button + Language + Mobile Menu */}
    <div class="flex items-center gap-3">
      {/* Language Switcher */}
      <a 
        href={otherLanguagePath} 
        class="flex items-center gap-1.5 px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium text-gray-700 hidden sm:flex"
        aria-label={isEnglish ? "Cambiar a EspaÃ±ol" : "Switch to English"}
        title={isEnglish ? "Cambiar a EspaÃ±ol" : "Switch to English"}
      >
        {isEnglish ? (
          <>
            <span>ðŸ‡ªðŸ‡¸</span>
            <span>ES</span>
          </>
        ) : (
          <>
            <span>ðŸ‡ºðŸ‡¸</span>
            <span>EN</span>
          </>
        )}
      </a>

      <a 
        href={`https://wa.me/${site.whatsappNumber}?text=${encodeURIComponent(texts.hola)}`}
        target="_blank"
        rel="noopener noreferrer"
        class="hidden sm:block bg-bergner-red hover:bg-red-700 text-white px-5 py-2 rounded-lg font-medium transition-colors text-sm"
      >
        {texts.cotizacion}
      </a>

      {/* Hamburger Menu (Mobile) */}
      <button 
        id="mobile-menu-toggle"
        class="md:hidden flex flex-col gap-1.5 cursor-pointer"
        aria-label="MenÃº mÃ³vil"
      >
        <span class="w-6 h-0.5 bg-gray-800 block transition-all"></span>
        <span class="w-6 h-0.5 bg-gray-800 block transition-all"></span>
        <span class="w-6 h-0.5 bg-gray-800 block transition-all"></span>
      </button>
    </div>
  </div>

  {/* Mobile Menu */}
  <div id="mobile-menu" class="hidden md:hidden border-t border-gray-100 bg-white">
    <nav class="flex flex-col py-4 px-4">
      <a href={`${langPrefix}/`} class="py-2 text-gray-700 hover:text-bergner-red transition-colors font-medium">
        {texts.inicio}
      </a>
      <a href={`${langPrefix}/metalurgica-bergner`} class="py-2 text-gray-700 hover:text-bergner-red transition-colors font-medium">
        {texts.quienesSomos}
      </a>
      <a href={`${langPrefix}/servicio-tecnico`} class="py-2 text-gray-700 hover:text-bergner-red transition-colors font-medium">
        {texts.servicios}
      </a>
      <a href={`${langPrefix}/productos`} class="py-2 text-gray-700 hover:text-bergner-red transition-colors font-medium">
        {texts.productos}
      </a>
      <a href={`${langPrefix}/contacto`} class="py-2 text-gray-700 hover:text-bergner-red transition-colors font-medium">
        {texts.contacto}
      </a>
      <a 
        href={`https://wa.me/${site.whatsappNumber}?text=${encodeURIComponent(texts.hola)}`}
        target="_blank"
        rel="noopener noreferrer"
        class="mt-4 bg-bergner-red hover:bg-red-700 text-white px-5 py-2 rounded-lg font-medium transition-colors text-center"
      >
        {texts.cotizacion}
      </a>
    </nav>
  </div>
</header>

<script>
  const toggleButton = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');

  toggleButton?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden');
  });
</script>
